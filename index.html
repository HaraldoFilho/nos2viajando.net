<!DOCTYPE html>
<html>
<head>
  <title>Nós Dois Viajando</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="style.css" />
  <!-- Mobile redirect script by https://www.pagecrafter.com -->
  <script type="text/javascript" src="js/redirection-mobile.js"></script>
  <script type="text/javascript">// <![CDATA[
    SA.redirection_mobile ({
      mobile_url : "nos2viajando.travelmap.net",
    });
  // ]]></script>
  <script src="js/mapbox_token.js"></script>
  <script src="js/countries_bbox.js"></script>

  <!-- Locations data -->
  <script src="data/cities.js"></script>
  <script src="data/parks.js"></script>
  <script src="data/accommodations.js"></script>
  <script src="data/airports.js"></script>

  <!-- Mapbox -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />

</head>
<body>


<div class="main-container">

  <div class="sidebar-container">

    <div class="top-container">
      <div class="avatar">
        <img class="avatar" src="avatar.jpg" title="Haraldo & Raquel" alt="Haraldo & Raquel"/>
      </div>
      <div class="title">
        Nós Dois Viajando
      </div>
      <div class="trips">
        <img class="metric" src="icons/luggage.svg"/>
        8 viagens
      </div>
      <div class="countries">
        <img class="metric" src="icons/world.svg"/>
        7 países
      </div>
      <div class="distance">
        <img class="metric" src="icons/distance.svg"/>
        58.065 km
      </div>
      <div class="days">
        <img class="metric" src="icons/days.svg"/>
        69 dias
      </div>
      <div class="map">
        <div id='map' style='width: 300px; height: 150px;'></div>
      </div>
      <div class="flags">
        <div id ='BR'><img class="flag" src="icons/flags/brazil.svg" title="Brasil" alt="Brasil"/></div>
        <div id ='AR'><img class="flag" src="icons/flags/argentina.svg" title="Argentina" alt="Argentina"/></div>
        <div id ='PY'><img class="flag" src="icons/flags/paraguay.svg" title="Paraguai" alt="Paraguai"/></div>
        <div id ='US'><img class="flag" src="icons/flags/united-states.svg" title="Estados Unidos" alt="Estados Unidos"/></div>
        <div id ='IT'><img class="flag" src="icons/flags/italy.svg" title="Itália" alt="Itália"/></div>
        <div id ='VA'><img class="flag" src="icons/flags/vatican.svg" title="Vaticano" alt="Vaticano"/></div>
        <div id ='HR'><img class="flag" src="icons/flags/croatia.svg" title="Croácia" alt="Croácia"/></div>
      </div>

    </div>

    <div id="lists" class="middle-container">
    </div>

    <div class="bottom-container">
    </div>

  </div>

  <div class="map-container">
    <iframe src="https://nos2viajando.travelmap.net/" frameBorder="0" allowfullscreen >
      Navegador não compatível
    </iframe>
  </div>

</div>

<script>

  mapboxgl.accessToken = mapbox_token;

  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10'
  });

  var initial_bbox = [];
  var current_bbox = [];

  var west = 180;
  var south = 90;
  var east = -180;
  var north = -90;

  var lng_offset = 0;
  var lat_offset = 10;

  for (var i = 0; i < airports.length; i++) {

    new mapboxgl.Marker({color:'#a0a0a0',scale:0.4,draggable:false})
    .setLngLat(airports[i][0])
    .setPopup(new mapboxgl.Popup({closeButton:false}).setText(airports[i][2]))
    .addTo(map);

  }

  for (var i = 0; i < accommodations.length; i++) {

    new mapboxgl.Marker({color:'#f6df00',scale:0.4,draggable:false})
    .setLngLat(accommodations[i][0])
    .setPopup(new mapboxgl.Popup({closeButton:false}).setText(accommodations[i][2]))
    .addTo(map);

  }

  for (var i = 0; i < parks.length; i++) {

    new mapboxgl.Marker({color:'#6cd26c',scale:0.4,draggable:false})
    .setLngLat(parks[i][0])
    .setPopup(new mapboxgl.Popup({closeButton:false}).setText(parks[i][2]))
    .addTo(map);

  }

  for (var i = 0; i < cities.length; i++) {

    new mapboxgl.Marker({scale:0.4,draggable:false})
    .setLngLat(cities[i][0])
    .setPopup(new mapboxgl.Popup({closeButton:false}).setText(cities[i][2]))
    .addTo(map);

    if (cities[i][0][0] < west) {
      west = cities[i][0][0];
    }
    if (cities[i][0][0] > east) {
      east = cities[i][0][0];
    }
    if (cities[i][0][1] < south) {
      south = cities[i][0][1];
    }
    if (cities[i][0][1] > north) {
      north = cities[i][0][1];
    }
    initial_bbox = [west, south, east, north];

  }

  initial_bbox[0] += lng_offset;
  initial_bbox[1] += lat_offset;
  initial_bbox[2] += lng_offset;
  initial_bbox[3] += lat_offset;

  map.fitBounds([
    [initial_bbox[0], initial_bbox[1]],
    [initial_bbox[2], initial_bbox[3]]],
    {padding: 30}
  );

  function fitRegion(region) {

    var bboxes = countries_bbox[region][1]

    var west = bboxes[0];
    var south = bboxes[1];
    var east = bboxes[2];
    var north = bboxes[3];

    map.fitBounds([
        [west, south],
        [east, north]],
        {padding: 5}
    );

  }

  function addListenerToItems(item) {
    document.getElementById(getItemId(item[2])).addEventListener('click', function() { flyToCoordinates(item[0]) });
  }

  function flyToCoordinates(coords) {
    map.flyTo({center: [coords[0], coords[1] + 0.02], zoom: 9});
  }

  function getIconSrc(country_code) {
    return "icons/flags/".concat(countries_bbox[country_code][0]
      .replace(/\s/g, "-").toLowerCase()).concat(".svg");
  }

  function getItemId(item_name) {
    return item_name.replace(/\s/g, "_").toUpperCase();
  }

  document.getElementById('BR').addEventListener('click', function() { fitRegion('BR') });
  document.getElementById('AR').addEventListener('click', function() { fitRegion('AR') });
  document.getElementById('PY').addEventListener('click', function() { fitRegion('PY') });
  document.getElementById('US').addEventListener('click', function() { fitRegion('US') });
  document.getElementById('IT').addEventListener('click', function() { fitRegion('IT') });
  document.getElementById('VA').addEventListener('click', function() { fitRegion('VA') });
  document.getElementById('HR').addEventListener('click', function() { fitRegion('HR') });

  var lists = document.getElementById('lists');

  var cities_list = document.createElement('DIV');
  cities_list.setAttribute('class', 'list-title');
  cities_list.innerText = 'Cidades';

  var parks_list = document.createElement('DIV');
  parks_list.setAttribute('class', 'list-title');
  parks_list.setAttribute('style', 'margin-top:25px');
  parks_list.innerText = 'Parques Nacionais';

  var accommodations_list = document.createElement('DIV');
  accommodations_list.setAttribute('class', 'list-title');
  accommodations_list.setAttribute('style', 'margin-top:25px');
  accommodations_list.innerText = 'Hospedagens';

  var airports_list = document.createElement('DIV');
  airports_list.setAttribute('class', 'list-title');
  airports_list.setAttribute('style', 'margin-top:25px');
  airports_list.innerText = 'Aeroportos';

  lists.appendChild(cities_list);
  for (var i = 0; i < cities.length; i++) {
    var list_item = document.createElement('P');
    var item_id = getItemId(cities[i][2]);
    list_item.setAttribute('id', item_id);
    list_item.setAttribute('class', 'list-item');
    var tiny_flag = document.createElement('IMG');
    tiny_flag.setAttribute('class', 'tiny_icon');
    tiny_flag.setAttribute('src', getIconSrc(cities[i][1]));
    list_item.appendChild(tiny_flag);
    list_item.append(cities[i][2]);
    lists.appendChild(list_item);
  }
  cities.forEach(addListenerToItems);

  lists.appendChild(parks_list);
  for (var i = 0; i < parks.length; i++) {
    var list_item = document.createElement('P');
    var list_item = document.createElement('P');
    var item_id = getItemId(parks[i][2]);
    list_item.setAttribute('id', item_id);
    list_item.setAttribute('class', 'list-item');
    var tiny_flag = document.createElement('IMG');
    tiny_flag.setAttribute('class', 'tiny_icon');
    tiny_flag.setAttribute('src', getIconSrc(parks[i][1]));
    list_item.appendChild(tiny_flag);
    list_item.append(parks[i][2]);
    lists.appendChild(list_item);
  }
  parks.forEach(addListenerToItems);

  lists.appendChild(accommodations_list);
  for (var i = 0; i < accommodations.length; i++) {
    var list_item = document.createElement('P');
    var item_id = getItemId(accommodations[i][2]);
    list_item.setAttribute('id', item_id);
    list_item.setAttribute('class', 'list-item');
    var tiny_flag = document.createElement('IMG');
    tiny_flag.setAttribute('class', 'tiny_icon');
    tiny_flag.setAttribute('src', getIconSrc(accommodations[i][1]));
    list_item.appendChild(tiny_flag);
    list_item.append(accommodations[i][2]);
    lists.appendChild(list_item);
  }
  accommodations.forEach(addListenerToItems);

  lists.appendChild(airports_list);
  for (var i = 0; i < airports.length; i++) {
    var list_item = document.createElement('P');
    var list_item = document.createElement('P');
    var item_id = getItemId(airports[i][2]);
    list_item.setAttribute('id', item_id);
    list_item.setAttribute('class', 'list-item');
    var tiny_flag = document.createElement('IMG');
    tiny_flag.setAttribute('class', 'tiny_icon');
    tiny_flag.setAttribute('src', getIconSrc(airports[i][1]));
    list_item.appendChild(tiny_flag);
    list_item.append(airports[i][2]);
    lists.appendChild(list_item);
  }
  airports.forEach(addListenerToItems);

</script>

</body>
</html>
